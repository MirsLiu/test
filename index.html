<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ARæ‰‹åŠ¿é­”æ³•åœ£è¯æ ‘</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  
  <style>
    body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
    #video_container { position: relative; width: 100vw; height: 100vh; }
    video { transform: scaleX(-1); width: 100%; height: 100%; object-fit: cover; }
    
    /* åœ£è¯æ ‘æ ·å¼å®¹å™¨ */
    #tree_target {
      position: absolute;
      font-size: 100px;
      pointer-events: none;
      z-index: 10;
      display: none;
      text-align: center;
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* æ ·å¼1ï¼šç»å…¸ç»¿ */
    .style-classic { filter: drop-shadow(0 0 10px green); }
    /* æ ·å¼2ï¼šå‘å…‰é‡‘ */
    .style-gold { filter: drop-shadow(0 0 20px gold); }
    /* æ ·å¼3ï¼šå†°æ™¶è“ */
    .style-ice { filter: drop-shadow(0 0 15px cyan); }

    .label {
      position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
      font-size: 18px; color: white; white-space: nowrap; background: rgba(0,0,0,0.5);
      padding: 2px 8px; border-radius: 10px;
    }

    .ui-hint {
      position: absolute; bottom: 30px; width: 90%; left: 5%;
      background: rgba(255,255,255,0.15); backdrop-filter: blur(5px);
      color: white; padding: 15px; border-radius: 15px; text-align: center; z-index: 20;
    }
  </style>
</head>
<body>

<div class="ui-hint" id="tip">æ­£åœ¨åˆå§‹åŒ– AI ç›¸æœº...</div>
<div id="video_container">
  <video id="input_video"></video>
  <div id="tree_target">
    <div class="label" id="tree_name">ç»å…¸æ¬¾</div>
    <span id="tree_icon">ğŸ„</span>
  </div>
</div>

<script>
const videoElement = document.getElementById('input_video');
const treeTarget = document.getElementById('tree_target');
const treeIcon = document.getElementById('tree_icon');
const treeName = document.getElementById('tree_name');
const tip = document.getElementById('tip');

// åˆ¤æ–­æ‰‹æŒ‡ä¼¸å‡ºä¸ªæ•°çš„é€»è¾‘
function countFingers(landmarks) {
  const tips = [8, 12, 16, 20]; // é£ŸæŒ‡ã€ä¸­æŒ‡ã€æ— åæŒ‡ã€å°æŒ‡æŒ‡å°–
  let count = 0;
  // æ‹‡æŒ‡é€»è¾‘ (æ¯”è¾ƒ x åæ ‡)
  if (landmarks[4].x < landmarks[3].x) count++; 
  // å…¶ä»–æ‰‹æŒ‡ (æ¯”è¾ƒ y åæ ‡)
  tips.forEach(idx => {
    if (landmarks[idx].y < landmarks[idx - 2].y) count++;
  });
  return count;
}

function onResults(results) {
  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];
    const fingerCount = countFingers(landmarks);
    
    // æ ¹æ®æ‰‹æŒ‡æ•°é‡åˆ‡æ¢æ ·å¼
    if (fingerCount >= 4) { // å¼ å¼€æ‰‹æŒ
        treeIcon.innerText = "ğŸ„";
        treeName.innerText = "ç»å…¸ç»¿";
        treeTarget.className = "style-classic";
    } else if (fingerCount === 0) { // æ¡æ‹³
        treeIcon.innerText = "âœ¨ğŸ„âœ¨";
        treeName.innerText = "å‘å…‰é‡‘";
        treeTarget.className = "style-gold";
    } else if (fingerCount === 1) { // ä¼¸å‡ºé£ŸæŒ‡
        treeIcon.innerText = "â„ï¸ğŸ„";
        treeName.innerText = "å†°æ™¶è“";
        treeTarget.className = "style-ice";
    }

    // åæ ‡è·Ÿéš (ä¸­æŒ‡æ ¹éƒ¨ç‚¹)
    const x = (1 - landmarks[9].x) * window.innerWidth;
    const y = landmarks[9].y * window.innerHeight;
    const scale = Math.hypot(landmarks[0].x - landmarks[12].x, landmarks[0].y - landmarks[12].y) * 3;

    treeTarget.style.display = 'block';
    treeTarget.style.left = `${x}px`;
    treeTarget.style.top = `${y}px`;
    treeTarget.style.transform = `translate(-50%, -80%) scale(${scale})`;
    
    tip.innerText = `æ£€æµ‹åˆ°: ${fingerCount} æ ¹æ‰‹æŒ‡ - å·²åˆ‡æ¢æ ·å¼`;
  } else {
    treeTarget.style.display = 'none';
    tip.innerText = "âœ‹ ä¼¸å‡ºä¸åŒæ•°é‡çš„æ‰‹æŒ‡åˆ‡æ¢æ ·å¼";
  }
}

const hands = new Hands({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});
hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });
hands.onResults(onResults);

const camera = new Camera(videoElement, {
  onFrame: async () => { await hands.send({image: videoElement}); },
  width: 1280, height: 720
});
camera.start();
</script>
</body>
</html>
