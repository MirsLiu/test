<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>ARæ‰‹åŠ¿å¬å”¤åœ£è¯æ ‘</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  
  <style>
    body { margin: 0; overflow: hidden; background: #000; font-family: 'PingFang SC', sans-serif; }
    #video_container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; }
    video { transform: scaleX(-1); width: 100%; height: 100%; object-fit: cover; }
    
    /* è£…é¥°åœ£è¯æ ‘ */
    #tree_wrapper {
      position: absolute;
      font-size: 80px;
      pointer-events: none;
      z-index: 10;
      display: none;
      filter: drop-shadow(0 0 15px rgba(255,215,0,0.8));
      text-align: center;
      transition: transform 0.1s ease-out;
    }
    
    .star { font-size: 30px; display: block; animation: blink 1s infinite; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

    .info-tip {
      position: absolute; top: 10%; width: 80%; left: 10%;
      background: rgba(0,0,0,0.6); color: white; padding: 15px;
      border-radius: 20px; text-align: center; z-index: 20;
    }
  </style>
</head>
<body>

<div class="info-tip" id="tip">æ­£åœ¨å¯åŠ¨ç›¸æœº...<br>è¯·åœ¨ HTTPS ç¯å¢ƒä¸‹è¿è¡Œå¹¶æˆæƒ</div>
<div id="video_container">
  <video id="input_video"></video>
  <div id="tree_wrapper">
    <span class="star">â­</span>
    ğŸ„
  </div>
</div>

<script>
const videoElement = document.getElementById('input_video');
const treeWrapper = document.getElementById('tree_wrapper');
const tip = document.getElementById('tip');

function onResults(results) {
  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    tip.style.display = 'none';
    const landmarks = results.multiHandLandmarks[0];
    
    // è·å–æŒå¿ƒå…³é”®ç‚¹ (ç¬¬9å·ç‚¹æ˜¯ä¸­æŒ‡æ ¹éƒ¨)
    const palmCenter = landmarks[9];
    
    // é•œåƒåæ ‡æ¢ç®—
    const x = (1 - palmCenter.x) * window.innerWidth;
    const y = palmCenter.y * window.innerHeight;
    
    // è®¡ç®—ç¼©æ”¾ï¼ˆåˆ©ç”¨æ‰‹æŒæ·±åº¦ï¼Œ0å·ç‚¹åˆ°12å·ç‚¹çš„è·ç¦»ï¼‰
    const scale = Math.hypot(landmarks[0].x - landmarks[12].x, landmarks[0].y - landmarks[12].y) * 2.5;

    treeWrapper.style.display = 'block';
    treeWrapper.style.left = `${x}px`;
    treeWrapper.style.top = `${y}px`;
    treeWrapper.style.transform = `translate(-50%, -70%) scale(${scale})`;
  } else {
    treeWrapper.style.display = 'none';
  }
}

const hands = new Hands({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});
hands.onResults(onResults);

const camera = new Camera(videoElement, {
  onFrame: async () => {
    await hands.send({image: videoElement});
  },
  width: 1280,
  height: 720
});

// æ£€æŸ¥æ˜¯å¦ä¸ºå®‰å…¨ç¯å¢ƒ
if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
    tip.innerHTML = "âš ï¸ éœ€è¦ HTTPS ç¯å¢ƒæ‰èƒ½å¼€å¯æ‘„åƒå¤´";
} else {
    camera.start().then(() => {
        tip.innerHTML = "âœ‹ ä¸¾èµ·æ‰‹æŒï¼Œå¬å”¤åœ£è¯æ ‘";
    });
}
</script>
</body>
</html>
